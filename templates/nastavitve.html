{% extends "base.html" %}
{% block content %}

<h1>Nastavitve – Competition Types</h1>
<hr>

<!-- New Button -->
<div class="mb-3">
    <button class="btn btn-success" data-toggle="modal" data-target="#newModal">
        + New
    </button>
</div>

<!-- Ožja tabela -->
<div style="max-width: 600px;">
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>ID</th>
            <th>Ime</th>
        </tr>
    </thead>
    <tbody>
    {% for item in items %}
        <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>

<!-- Modal za NEW -->
<div class="modal fade" id="newModal" tabindex="-1" role="dialog" aria-labelledby="newModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="post" action="{{ url_for('add_competition_type') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="newModalLabel">Dodaj Competition Type</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Zapri">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Ime</label>
            <input type="text" name="name" class="form-control" required>
            <small id="nameExistsWarning" class="text-danger mt-1" style="display:none;">To ime že obstaja!</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Shrani</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Prekliči</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- JS za preverjanje dupliciranih imen -->
<script>
$(document).ready(function(){

    // Array obstoječih imen (lowercase)
    const existingNames = [
        {% for item in items %}
            "{{ item.name|lower }}",
        {% endfor %}
    ];

    // Hook na input
    $('#newModal input[name="name"]').on('input', function(){
        const value = $(this).val().trim().toLowerCase();
        if(existingNames.includes(value)){
            // Onemogoči gumb Shrani
            $('#newModal button[type="submit"]').prop('disabled', true);
            $('#nameExistsWarning').show();
        } else {
            // Omogoči gumb + skrij warning
            $('#newModal button[type="submit"]').prop('disabled', false);
            $('#nameExistsWarning').hide();
        }
    });

    // Ko se modal odpre, počisti input in warning
    $('#newModal').on('show.bs.modal', function () {
        $(this).find('input[name="name"]').val('');
        $(this).find('#nameExistsWarning').hide();
        $(this).find('button[type="submit"]').prop('disabled', false);
    });

});
</script>

{% endblock %}
